<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="layout :: layout(~{::body})">

<body>

<div th:if="${show != null}" th:attr="data-show-id=${show.id}" class="show-details">

    <h1 th:text="${show.movie != null ? show.movie.title : 'Brak tytułu'}">Tytuł filmu</h1>

    <p class="meta">
        <strong>Opis:</strong>
        <span th:text="${show.movie != null && show.movie.description != null ? show.movie.description : 'Brak opisu'}"></span>
    </p>

    <p class="meta">
        <strong>Seans:</strong>
        <span th:text="${show.startTime != null ? #temporals.format(show.startTime, 'dd-MM-yyyy HH:mm') : 'Brak daty'}"></span>
        <br/>
        <strong>Sala:</strong>
        <span th:text="${show.room != null ? show.room.name : 'Brak sali'}"></span>
    </p>

    <h2>Wybierz miejsca</h2>

    <div class="screen">EKRAN</div>

    <form th:action="@{/cart/add}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" name="showtimeId" th:value="${show.id}" />

        <div class="seat-grid">
            <div th:each="rowEntry : ${seatsByRow}" class="seat-row">
                <span class="row-label" th:text="'Rząd ' + ${rowEntry.key}"></span>

                <div class="seats">
                    <label th:each="seat : ${rowEntry.value}"
                           th:class="'seat-box ' + (${takenSeatIds.contains(seat.id)} ? 'taken' : 'available')"
                           th:title="'Rząd ' + ${seat.rowNum} + ', miejsce ' + ${seat.seatNum}">

                        <input type="checkbox"
                               name="seatIds"
                               th:value="${seat.id}"
                               th:disabled="${takenSeatIds.contains(seat.id)}" />

                        <span class="seat" th:text="${seat.seatNum}"></span>
                    </label>
                </div>
            </div>
        </div>
        <br>
        <button type="submit">Dodaj do koszyka</button>
    </form>
</div>

<div th:if="${show.room == null or seatsByRow == null or seatsByRow.isEmpty()}">
    <p>Brak zdefiniowanych miejsc dla tej sali.</p>
    <a th:href="@{/showtimes}">Powrót do listy seansów</a>
</div>

<div th:if="${show == null}">
    <p>Nie znaleziono seansu.</p>
    <a th:href="@{/showtimes}">Powrót</a>
</div>

</body>
</html>
